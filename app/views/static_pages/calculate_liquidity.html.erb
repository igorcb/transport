<div class="text-center">
	<h1>Calcular Frete</h1>
</div>



<%= form_tag( id: "form_calculate_liquidoty", :html => { }) do %>

	<div class="panel panel-default">
	  <div class="panel-heading">Liquidez por tarifa</div>
	  <div class="panel-body">

    <div class="form-group">
      <%= label_tag :type_charge_id, "Tipo de Carga"  %>
      <%= select_tag :type_charge_id, options_for_select(select_type_charge_freight, TableFreight::TypeCharge::CARGA_GERAL), class: "form-control", onfocusout:"getFreightMinimum();" %>
    </div>      

    <div class="form-group">
      <%= label_tag :qtde_eixos, "Qtde de Eixos" %>
      <%= select_tag :qtde_eixos, options_for_select(select_eixos, 5), class: "form-control", onfocusout:"getFreightMinimum(); " %>
    </div>

    <div class="form-group">
      <%= label_tag :trecho_id, "Trecho" %>
      <%#= select_tag :trecho_id, options_from_collection_for_select(StretchRoute.all, :id, :stretch_source_and_target_short), :prompt => "Selecione o Trecho", class: "form-control" %>
      <%= select_tag :trecho_id, options_from_collection_for_select(StretchRoute.order(:id), :id, :stretch_source_and_target_short, StretchRoute.order(:id).first.id), class: "form-control", onfocusout:"getFreightMinimum();" %>
    </div>

    <div class="form-group">
      <%= label_tag :insurer_id, "Seguradora" %>
      <%= select_tag :insurer_id, options_from_collection_for_select(Insurer.order(:name), :id, :name, Insurer.order(:name).first.id), class: "form-control", onfocusout:"getFreightMinimum();" %>
    </div>

    <div class="form-group">
      <%= label_tag :type_insurance_id, "Tipo de Seguro"  %>
      <%= select_tag :type_insurance_id, options_for_select(select_type_policie, PolicieInsurance::TypePolicie::RCTRC), class: "form-control", onfocusout:"getFreightMinimum();" %>
    </div>      

	  <div class="form-group">
	    <%= label_tag :valor_nota_fiscal %>
	    <%= text_field :valor_nota_fiscal, nil, value: 0, class: "form-control money2", id: 'valor_nota_fiscal', onfocusout:"getFreightMinimum();" %>
	  </div>

	  <div class="form-group">
	    <%= label_tag :peso_bruto %>
	    <%= text_field :peso_bruto, nil, value: 0, class: "form-control money3", id: 'peso_bruto', onfocusout:"getFreightMinimum(); " %>
	  </div>

	  <div class="form-group">
	    <%= label_tag :valor_tonelada, "Valor por Tonelada" %>
	    <%= text_field :valor_tonelada, nil, value: 0, class: "form-control money2", id: 'valor_tonelada', onfocusout:"getFreightMinimum();" %>
	  </div>

	  <div class="form-group">
	    <%= label_tag :valor_diaria, "Diaria" %>
	    <%= text_field :valor_diaria, nil, value: 0, class: "form-control money2", id: 'valor_diaria', onfocusout:"getFreightMinimum();" %>
	  </div>

    <div class="form-group">
      <%= label_tag :risk_manager, "GR" %>
      <%= text_field :risk_manager, nil, value: 0, class: "form-control money2", id: 'risk_manager', onfocusout:"getFreightMinimum();" %>
    </div>

    <div class="form-group">
      <%= label_tag :toll, "Pedagio" %>
      <%= text_field :toll, nil, value: 0, class: "form-control money2", id: 'toll', onfocusout:"getFreightMinimum();" %>
    </div>

    <div class="form-group">
      <%= label_tag :lucre, "Lucro %" %>
      <%= text_field :lucre, nil, value: 0, class: "form-control money2", id: 'lucre', onfocusout:"getFreightMinimum();" %>
    </div>


	</div>

<% end %>

<div id="div_freight_minimal"></div>    


<script type="text/javascript">
  $(document).ready(function() {
   $("#trecho_id").change(function() {
      var id = $('#trecho_id').val();
      console.log(id);
      $.ajax({
        type: "GET",
        data: {id: id},
        dataType : 'html',
        url: '/stretch_routes/get_stretch_route_by_id',
        success: function(data){
          $('#div_result_trecho').html(data);
        },
      });
    });
  });
</script>

<script type="text/javascript">
  $(document).ready(function() {
   $("#trecho_id, #type_charge_id").change(function() {
      getFreightMinimum();
    });
  });
</script>

<script type="text/javascript">

  Number.prototype.formatMoney = function(c, d, t){
  var n = this, 
      c = isNaN(c = Math.abs(c)) ? 2 : c, 
      d = d == undefined ? "." : d, 
      t = t == undefined ? "," : t, 
      s = n < 0 ? "-" : "", 
      i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "", 
      j = (j = i.length) > 3 ? j % 3 : 0;
     return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
   };

  function getFreightMinimum() {
    // var trecho_id = $('#trecho_id').val();
    // var type_charge_id = $('#type_charge_id').val();
    // var eixos = $('#qtde_eixos').val();

    var value_nf   = $('#valor_nota_fiscal').val();
    var weight     = $('#peso_bruto').val();
    var value_ton  = $('#valor_tonelada').val();
    var eixos      = $('#qtde_eixos').val(); 
    var daily_rate = $('#valor_diaria').val();
    var risk_manager   = $('#risk_manager').val();
    var lucre          = $('#lucre').val();
    var toll           = $('#toll').val();
    var trecho_id      = $('#trecho_id').val();
    var type_charge_id = $('#type_charge_id').val();
    var insurer_id     = $('#insurer_id').val();

    if ((trecho_id != "") && (type_charge_id != "")) {
      $.ajax({
        type: "GET",
        data: {value_nf: value_nf, weight: weight, value_ton: value_ton, trecho_id: trecho_id, type_charge_id: type_charge_id, daily_rate: daily_rate, eixos: eixos, insurer_id: insurer_id, daily_rate: daily_rate, risk_manager: risk_manager, toll: toll, lucre: lucre},
        dataType : 'html',
        url: '/table_freights/get_calc_freight_minimum',
        success: function(data){
          $('#div_freight_minimal').html(data);
        },   
      });
    }
  }

  // function calculateFreight() {
  //   var valor_nf = $("#valor_nota_fiscal").val();
  //   var peso_bruto = $("#peso_bruto").val();
  //   var vr_tonelada = $("#valor_tonelada").val();
  //   var vr_descarga = $("#valor_descarga").val();
  //   var vr_ton = vr_tonelada / 1000;
  //   var value_service = peso_bruto * vr_ton + parseFloat(vr_descarga);
    
  //   //document.getElementById('valor_total').value = 'R$ ' + sum.formatMoney(2, ',', '.');
  //   $("#div_value_contract").html("<strong>Vr. Contrato:</strong> R$ " + value_service.formatMoney(2, ',', '.'));
  // }
</script>